@model QuanLyGiongChanNuoi.Web.ViewModels.DashboardViewModel

@{
    ViewData["Title"] = "Báo cáo thống kê";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<h2 class="page-title"><i class="fa-solid fa-chart-line"></i> Báo Cáo - Thống Kê Tổng Hợp</h2>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary shadow-sm h-100">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="card-title text-uppercase">Tổng Người Dùng</h6>
                    <h2 class="display-6 fw-bold">@Model.TongNguoiDung</h2>
                </div>
                <i class="fa-solid fa-users fa-3x opacity-50"></i>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card text-white bg-success shadow-sm h-100">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="card-title text-uppercase">Truy Cập Hôm Nay</h6>
                    <h2 class="display-6 fw-bold">@Model.LuotTruyCapHomNay</h2>
                </div>
                <i class="fa-solid fa-right-to-bracket fa-3x opacity-50"></i>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card text-white bg-warning shadow-sm h-100">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="card-title text-uppercase">Hành Động Hôm Nay</h6>
                    <h2 class="display-6 fw-bold text-dark">@Model.TacDongHeThongHomNay</h2>
                </div>
                <i class="fa-solid fa-database fa-3x opacity-50 text-dark"></i>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card text-white bg-info shadow-sm h-100">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="card-title text-uppercase">Nhân Sự Mới (Tháng)</h6>
                    <h2 class="display-6 fw-bold">@Model.NguoiDungMoiThangNay</h2>
                </div>
                <i class="fa-solid fa-user-plus fa-3x opacity-50"></i>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-8">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white fw-bold">
                <i class="fa-solid fa-clock-rotate-left text-primary"></i> Xu hướng truy cập (7 ngày qua)
            </div>
            <div class="card-body">
                <canvas id="accessChart"></canvas>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white fw-bold">
                <i class="fa-solid fa-chart-pie text-success"></i> Phân bổ theo Đơn vị
            </div>
            <div class="card-body">
                <canvas id="userUnitChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card shadow-sm">
            <div class="card-header bg-white fw-bold">
                <i class="fa-solid fa-server text-warning"></i> Thống kê Thêm / Sửa / Xóa (Toàn thời gian)
            </div>
            <div class="card-body">
                <canvas id="actionChart"></canvas>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white fw-bold">
                <i class="fa-solid fa-link text-info"></i> Truy cập nhanh báo cáo chi tiết
            </div>
            <div class="card-body">
                <div class="list-group">
                    <a asp-controller="NguoiDung" asp-action="Index" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <span><i class="fa-solid fa-users me-2"></i> Quản lý danh sách người dùng</span>
                        <span class="badge bg-primary rounded-pill">@Model.TongNguoiDung</span>
                    </a>
                    <a asp-controller="LichSuTruyCap" asp-action="Index" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <span><i class="fa-solid fa-file-contract me-2"></i> Xem chi tiết lịch sử truy cập</span>
                        <span class="badge bg-primary rounded-pill"><i class="fa-solid fa-arrow-right"></i></span>
                    </a>
                    <a asp-controller="LichSuTacDong" asp-action="Index" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <span><i class="fa-solid fa-pen-to-square me-2"></i> Xem chi tiết lịch sử tác động</span>
                        <span class="badge bg-primary rounded-pill"><i class="fa-solid fa-arrow-right"></i></span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 1. Dữ liệu từ Server đổ vào biến JS
    const labelsAccess = @Html.Raw(Json.Serialize(Model.LabelNgayTruyCap));
    const dataAccess = @Html.Raw(Json.Serialize(Model.DataLuotTruyCap));

    const labelsDonVi = @Html.Raw(Json.Serialize(Model.LabelDonVi));
    const dataDonVi = @Html.Raw(Json.Serialize(Model.DataDonVi));

    const dataAction = [@Model.SoLuongThem, @Model.SoLuongSua, @Model.SoLuongXoa];

    // 2. Vẽ biểu đồ Truy Cập (Line Chart)
    new Chart(document.getElementById('accessChart'), {
        type: 'line',
        data: {
            labels: labelsAccess,
            datasets: [{
                label: 'Lượt truy cập',
                data: dataAccess,
                borderColor: '#0d6efd',
                backgroundColor: 'rgba(13, 110, 253, 0.1)',
                fill: true,
                tension: 0.3 // Làm cong đường nối
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
        }
    });

    // 3. Vẽ biểu đồ Đơn vị (Pie Chart)
    new Chart(document.getElementById('userUnitChart'), {
        type: 'doughnut',
        data: {
            labels: labelsDonVi,
            datasets: [{
                data: dataDonVi,
                backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796'],
                hoverOffset: 4
            }]
        },
        options: { responsive: true }
    });

    // 4. Vẽ biểu đồ Tác động (Bar Chart)
    new Chart(document.getElementById('actionChart'), {
        type: 'bar',
        data: {
            labels: ['Thêm mới', 'Cập nhật', 'Xóa'],
            datasets: [{
                label: 'Số lượng tác động',
                data: dataAction,
                backgroundColor: [
                    'rgba(25, 135, 84, 0.7)', // Xanh lá (Thêm)
                    'rgba(255, 193, 7, 0.7)', // Vàng (Sửa)
                    'rgba(220, 53, 69, 0.7)'  // Đỏ (Xóa)
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: { y: { beginAtZero: true } },
            plugins: { legend: { display: false } }
        }
    });
</script>